<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EarlyON Ottawa</title>
    <style>
        table {
            border-collapse: collapse;
            width: 100%;
            margin-top: 20px;
        }
        th, td {
            border: 1px solid #dddddd;
            text-align: left;
            padding: 8px;
        }
        h2 {
            margin-top: 20px;
        }
        label {
            display: block;
            margin-top: 10px;
        }
    </style>
    <!-- Include PapaParse library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
</head>
<body>

    <h1>EarlyON Ottawa <small>Version 1.0</small></h1>

    <label for="selectedDate">Select Date:</label>
    <input type="date" id="selectedDate">

    <p>Welcome to the central repository of all the EarlyON groups in Ottawa! Finally a place where parents can see details for all the playgroups in the city. Please note that it is highly recommended to visit the source URL to ensure that the playgroup you are planning to attend is still running. Some playgroups also require registration.</p>

    <div id="csvData"></div>

    <p>The data from this table was taken from the various Ottawa EarlyON playgroups posted on the <a href="https://ottawa.ca/en/family-and-social-services/childrens-services/earlyon" target="_blank">Ottawa.ca website</a>.</p>

    <h2>Next Steps</h2>
    <ul>
        <li>Lots of data entry needed! Unfortunately, most calendars are published as PDFs so it is not possible to automate a Python script to read data off of the individual websites</li>
        <li>Add ability to filter (by date, by area, by language)</li>
        <li>Add ability to sort</li>
        <li>Ensure header is always visible even when we scroll</li>
        <li>Ensure dates that are past don't appear</li>
        <li>Contact EarlyON employees to see if they can help with data entry</li>
        <li>Improve the look of the website</li>
        <li>Get the word out! :)</li>
    </ul>

    <script>
        let originalData = []; // Initialize as an empty array

        window.onload = function () {
            // Update the path to your CSV file
            const csvFilePath = 'https://claudielarouche.com/earlyON/data.csv';

            Papa.parse(csvFilePath, {
                header: true,
                download: true,
                skipEmptyLines: true,
                complete: function(results) {
                    // Check if the data is an array
                    if (Array.isArray(results.data)) {
                        originalData = results.data;
                        renderTable(originalData);
                    } else {
                        console.error('Error loading data: Data is not an array.');
                        document.getElementById('csvData').innerHTML = 'Error loading data.';
                    }
                },
                error: function(error) {
                    console.error('Error parsing CSV:', error);
                    document.getElementById('csvData').innerHTML = 'Error loading data.';
                }
            });
        };

        function renderTable(data) {
            // Ensure data is an array
            if (!Array.isArray(data)) {
                console.error('Error loading data: Data is not an array.');
                document.getElementById('csvData').innerHTML = 'Error loading data.';
                return;
            }

            // Check if data is empty
            if (data.length === 0) {
                console.warn('No data available.');
                document.getElementById('csvData').innerHTML = 'No data available.';
                return;
            }

            const headers = Object.keys(data[0]);

            let tableHtml = '<table id="dataTable"><thead><tr>';
            headers.forEach(header => {
                tableHtml += `<th>${header}</th>`;
            });
            tableHtml += '</tr></thead><tbody>';

            const selectedDate = document.getElementById('selectedDate').value;

            const filteredData = filterDataByDate(data, selectedDate);

            if (!Array.isArray(filteredData)) {
                console.error('Error loading data: Filtered data is not an array.');
                document.getElementById('csvData').innerHTML = 'Error loading data.';
                return;
            }

            filteredData.forEach(row => {
                tableHtml += '<tr>';
                headers.forEach(header => {
                    if (header === 'URL') {
                        // Make the URL clickable as a link
                        tableHtml += `<td><a href="${row[header]}" target="_blank">URL</a></td>`;
                    } else {
                        tableHtml += `<td>${row[header]}</td>`;
                    }
                });
                tableHtml += '</tr>';
            });

            tableHtml += '</tbody></table>';

            document.getElementById('csvData').innerHTML = tableHtml;
        }

        function filterDataByDate(data, selectedDate) {
            // If no date is selected, return the original data
            if (!selectedDate) {
                return data;
            }

            // Ensure data is an array before filtering
            if (Array.isArray(data)) {
                return data.filter(row => {
                    const currentDate = row['Date'] ? row['Date'] : '';
                    return currentDate === selectedDate;
                });
            } else {
                return [];
            }
        }

        // Listen for changes in date input
        document.getElementById('selectedDate').addEventListener('change', renderTable);
    </script>

</body>
</html>
