<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Charts</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.datatables.net/1.10.24/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/buttons/1.7.1/js/dataTables.buttons.min.js"></script>
    <script src="https://cdn.datatables.net/buttons/1.7.1/js/buttons.colVis.min.js"></script>
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.10.24/css/jquery.dataTables.min.css"/>
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/buttons/1.7.1/css/buttons.dataTables.min.css"/>
    <script src="https://d3js.org/d3.v5.min.js"></script>
</head>
<body>

<h1>Charts</h1>

<!-- Container for the chart -->
<div id="chart-container"></div>

<!-- Container for the data table -->
<div id="csvData"></div>

<script>
    // Load the data from the archive.csv file
    d3.csv('https://claudielarouche.com/earlyON/archive.csv').then(data => {
        // Your chart code here

        // For example, let's create a simple bar chart showing the count of rows by "Day of Week"
        const dayOfWeekCounts = d3.nest()
            .key(d => d['Day of Week'])
            .rollup(v => v.length)
            .entries(data);

        const svg = d3.select('#chart-container')
            .append('svg')
            .attr('width', 400)
            .attr('height', 300);

        const margin = { top: 20, right: 20, bottom: 30, left: 40 };
        const width = 400 - margin.left - margin.right;
        const height = 300 - margin.top - margin.bottom;

        const x = d3.scaleBand()
            .domain(dayOfWeekCounts.map(d => d.key))
            .range([margin.left, width - margin.right])
            .padding(0.1);

        const y = d3.scaleLinear()
            .domain([0, d3.max(dayOfWeekCounts, d => d.value)])
            .nice()
            .range([height - margin.bottom, margin.top]);

        svg.append('g')
            .attr('transform', `translate(0,${height - margin.bottom})`)
            .call(d3.axisBottom(x));

        svg.append('g')
            .attr('transform', `translate(${margin.left},0)`)
            .call(d3.axisLeft(y));

        svg.selectAll('.bar')
            .data(dayOfWeekCounts)
            .enter().append('rect')
            .attr('class', 'bar')
            .attr('x', d => x(d.key))
            .attr('y', d => y(d.value))
            .attr('width', x.bandwidth())
            .attr('height', d => height - margin.bottom - y(d.value));

        // Render the data table
        renderTable(data);
    });

    function renderTable(data) {
        // Your existing table rendering code
        // ...

        // Initialize DataTable only once
        if (!$.fn.dataTable.isDataTable('#dataTable')) {
            $('#dataTable').DataTable({
                "pageLength": -1,
                "dom": 'Bfrtip', // 'B' for buttons
                "buttons": [
                    'colvis' // Column visibility button
                ]
            });
        }
        $('#dataTable_filter input').val(currentSearchValue).trigger('input');
    }

    // Listen for changes in date input
    document.getElementById('selectedDate').addEventListener('change', function() {
        currentSearchValue = $('#dataTable_filter input').val();
        renderTable(originalData);
    });

    // Listen for changes in the Area select input
    document.getElementById('selectedArea').addEventListener('change', function() {
        currentSearchValue = $('#dataTable_filter input').val();
        renderTable(originalData);
    });
</script>

</body>
</html>
