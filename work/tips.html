<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Web Scraping Tool</title>
<style>
    /* Add your CSS styles here */
</style>
</head>
<body>
    <h1>Web Scraping Tool v11</h1>
    <form id="scrapingForm">
        <label for="urls">Enter URLs (separated by carriage return):</label><br>
        <textarea id="urls" rows="4" cols="50">https://www.canada.ca/en/canadian-heritage/corporate/publications/plans-reports/departmental-plan-2024-2025.html</textarea><br>
        <label for="searchText">Enter Text to Search:</label><br>
        <input type="text" id="searchText" name="searchText" value="Planning for contracts awarded to Indigenous businesses"><br><br>
        <button type="button" onclick="scrape()">Scrape</button>
    </form>
    <div id="results">
        <!-- Display scraping results here -->
    </div>

    <script>
        function scrape() {
    var urlsInput = document.getElementById("urls").value.trim().split("\n");
    var searchText = document.getElementById("searchText").value.trim();

    // Clear previous results
    document.getElementById("results").innerHTML = "";

    urlsInput.forEach(function(url) {
        fetch(url)
        .then(response => response.text())
        .then(data => {
            var parser = new DOMParser();
            var htmlDoc = parser.parseFromString(data, 'text/html');
            var headings = htmlDoc.querySelectorAll('h1, h2, h3, h4, h5, h6');

            var headingFound = false;
            var headingLevel = -1;

            headings.forEach(function(heading, index) {
                if (!headingFound && heading.textContent.includes(searchText)) {
                    headingFound = true;
                    headingLevel = getNextHeadingLevel(heading);
                } else if (headingFound && getNextHeadingLevel(heading) <= headingLevel) {
                    headingFound = false;
                }

                if (headingFound) {
                    var nextHeading = headings[index + 1];
                    if (nextHeading) {
                        var text = getTextBetweenNodes(heading.nextSibling, nextHeading);
                        var resultElement = document.createElement("div");
                        if (nextHeading.tagName === "TABLE") {
                            resultElement.innerHTML = text;
                        } else {
                            resultElement.textContent = text;
                        }
                        document.getElementById("results").appendChild(resultElement);
                    }
                }
            });
        })
        .catch(error => console.error('Error fetching data:', error));
    });
}

function getNextHeadingLevel(heading) {
    return parseInt(heading.tagName.substring(1));
}

function getTextBetweenNodes(startNode, endNode) {
    var text = '';
    var currentNode = startNode;

    while (currentNode && currentNode !== endNode) {
        if (currentNode.nodeType === Node.TEXT_NODE) {
            text += currentNode.textContent.trim() + ' ';
        } else if (currentNode.nodeType === Node.ELEMENT_NODE) {
            // Handle nested elements
            text += getTextBetweenNodes(currentNode.firstChild, null);
        }
        currentNode = currentNode.nextSibling;
    }

    return text.trim();
}




    </script>
</body>
</html>
