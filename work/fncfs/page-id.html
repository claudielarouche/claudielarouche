<!DOCTYPE html>
<html lang="en">
<head>
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-YWMRD8LX5P"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-YWMRD8LX5P');
</script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Page Identification Tool</title>
    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .container {
            margin-top: 20px;
        }
        .input-group-text {
            min-width: 100px;
        }
	textarea {
            overflow: hidden; /* Prevents scroll bar from appearing */
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Page Identification Tool</h1>
        <p>Please use the buttons below or hit the letters A for Automation, D for DINE, R for RTL, M for Manual, and T for TBD. 
        Every time you press a button, the tool will take the "current page" number from the input box and place it in the correct location in the text below.
        The text can be edited as needed. For this tool to work, please do not remove the text Automation, DINE, RTL, Manual, TBD from the final input box below.</p>

        <div class="input-group mb-3">
            <div class="input-group-prepend">
                <span class="input-group-text">Current Page</span>
            </div>
            <input type="number" id="pageNumber" class="form-control" value="1">
        </div>

        <div class="btn-group mb-3" role="group" aria-label="Page Buttons">
            <button type="button" class="btn btn-primary" onclick="addToText('Automation')">A - Automation</button>
            <button type="button" class="btn btn-secondary" onclick="addToText('DINE')">D - DINE</button>
            <button type="button" class="btn btn-success" onclick="addToText('RTL')">R - RTL</button>
            <button type="button" class="btn btn-danger" onclick="addToText('Manual')">M - Manual</button>
            <button type="button" class="btn btn-warning" onclick="addToText('TBD')">T - TBD</button>
        </div>

        <textarea class="form-control" id="finalText" rows="8" oninput="adjustTextArea(this)">Automation: 
DINE: 
RTL: 
Manual: 
TBD: 
</textarea>

        <button class="btn btn-info mt-3" onclick="createFinalRecord()">Create Final Record</button>
        <p id="recordDisplay"></p>
        <p id="instructionDisplay"></p>
        <button class="btn btn-warning mt-2" onclick="startOver()">Start Over</button>
    </div>

    <script>
        let historyStack = [];
        document.body.addEventListener('keydown', function(event) {
            const keyName = event.key.toUpperCase();
            if ((event.ctrlKey || event.metaKey) && keyName === 'Z') {
                undoLastAction();
            } else if (keyName === 'A' || keyName === 'D' || keyName === 'R' || keyName === 'M' || keyName === 'T') {
                const buttonMap = {
                    'A': 'Automation',
                    'D': 'DINE',
                    'R': 'RTL',
                    'M': 'Manual',
                    'T': 'TBD'
                };
                addToText(buttonMap[keyName]);
            }
        });

        function addToText(category) {
            const pageInput = document.getElementById('pageNumber');
            let pageNumber = parseInt(pageInput.value);
            const finalText = document.getElementById('finalText');
            const lines = finalText.value.split('\n');
            const updatedLines = lines.map(line => {
                if (line.startsWith(category + ':')) {
                    historyStack.push(finalText.value); // Save the current state before updating
                    return line + pageNumber + ', ';
                } else {
                    return line;
                }
            });
            finalText.value = updatedLines.join('\n');
            pageInput.value = pageNumber + 1;
        }

        function createFinalRecord() {
            let text = document.getElementById('finalText').value;
            text = text.split('\n').map(line => {
                if (!line.trim().endsWith(':')) { // Removes categories without any pages.
                    return line.replace(/,\s*$/, ''); // Removes trailing commas.
                }
            }).filter(line => line).join(', '); // Joins lines with comma and space, removing extra line breaks.
            document.getElementById('recordDisplay').innerText = text;

            // Determine instructions based on content
            provideInstructions(text);
        }

        function provideInstructions(text) {
			const counts = {
				automation: (text.match(/Automation:/g) || []).length,
				manual: (text.match(/Manual:/g) || []).length,
				dine: (text.match(/DINE:/g) || []).length,
				rtl: (text.match(/RTL:/g) || []).length
			};
			let instructions = '';

			if (counts.automation > 0 && counts.dine === 0 && counts.rtl === 0 && counts.manual === 0) {
				instructions = 'Please add the file to the <a href="https://042gc.sharepoint.com/:x:/r/sites/TemplateQCTeams/_layouts/15/Doc.aspx?sourcedoc=%7BC31D2EAA-7716-4911-8136-326EEBE64786%7D&file=Review%20Log.xlsx&action=default&mobileredirect=true&isSPOFile=1" target="_blank">Review log</a>.';
			} else if (counts.dine > 0 && counts.automation === 0 && counts.rtl === 0 && counts.manual === 0) {
				instructions = 'Please send the file to Rejected with the parser (no need to add to any log)';
			} else if (counts.rtl > 0 && counts.automation === 0 && counts.dine === 0 && counts.manual === 0) {
				instructions = 'Please send the file to Manual with the parser (no need to add to any log)';
			} else if (counts.manual > 0 && counts.automation === 0 && counts.dine === 0 && counts.rtl === 0) {
				instructions = 'Please send the file to Manual with the parser (no need to add to any log)';
			} else if (counts.automation > 0 && (counts.dine > 0 || counts.rtl > 0) && counts.manual === 0) {
				instructions = 'Please add the file to the <a href="https://042gc.sharepoint.com/:x:/r/sites/TemplateQCTeams/_layouts/15/Doc.aspx?sourcedoc=%7BC31D2EAA-7716-4911-8136-326EEBE64786%7D&file=Review%20Log.xlsx&action=default&mobileredirect=true&isSPOFile=1" target="_blank">Review Log</a>.';
			} else if (counts.automation > 0 && counts.manual > 0) {
				instructions = 'Please add the file to the <a href="https://042gc.sharepoint.com/:x:/r/sites/TemplateQCTeams/_layouts/15/Doc.aspx?sourcedoc=%7BC31D2EAA-7716-4911-8136-326EEBE64786%7D&file=Review%20Log.xlsx&action=default&mobileredirect=true&isSPOFile=1" target="_blank">Review log</a> and to the <a href="https://042gc.sharepoint.com/:x:/r/sites/TemplateQCTeams/_layouts/15/Doc.aspx?sourcedoc=%7BD74A1724-574A-4164-8475-F69449BA732F%7D&file=Files%20for%20Manual%20Team.xlsx&action=default" target="_blank">Manual Log</a>.';
			} else if ((counts.dine > 0 && counts.rtl > 0) || (counts.dine > 0 && counts.manual > 0) || (counts.rtl > 0 && counts.manual > 0) || (counts.dine > 0 && counts.rtl > 0 && counts.manual > 0)) {
				instructions = 'Please send the file to Manual with the parser (no need to add to any log)';
			}

			document.getElementById('instructionDisplay').innerHTML = instructions;
		}


        function startOver() {
            document.getElementById('pageNumber').value = '1';
            document.getElementById('finalText').value = 'Automation: \nDINE: \nRTL: \nManual: \nTBD: \n';
            document.getElementById('recordDisplay').innerText = '';
            document.getElementById('instructionDisplay').innerText = '';
            historyStack = []; // Clear history on start over
        }

	function adjustTextArea(textarea) {
            textarea.style.height = ""; // Reset the height
            textarea.style.height = Math.min(textarea.scrollHeight, window.innerHeight) + "px";
        }

        function undoLastAction() {
            if (historyStack.length > 0) {
                const previousState = historyStack.pop();
                document.getElementById('finalText').value = previousState;
                // Optionally decrement the page number
                const pageInput = document.getElementById('pageNumber');
                let currentPage = parseInt(pageInput.value);
                pageInput.value = Math.max(1, currentPage - 1);
            }
        }
    </script>
</body>
</html>

