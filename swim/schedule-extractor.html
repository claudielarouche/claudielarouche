
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>City of Ottawa Activity Schedule Extractor</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
		<!--<link rel="stylesheet" type="text/css" href="style.css">-->
		<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
		<link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.11.5/css/jquery.dataTables.css">
		<link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
<style>
        #urls {
            width: 100%;
            height: 25em; /* 25 lines */
        }
    </style>
</head>
<body>
	<div class="container">
    <h1>City of Ottawa Activity Schedule Extractor v22</h1>
		<p>Last version that works perfectly is v20</p>
    <form id="scrapingForm">
        <label for="urls">Enter URLs (separated by carriage return):</label><br>
        <textarea id="urls" rows="4" cols="50">https://ottawa.ca/en/recreation-and-parks/facilities/place-listing/francois-dupuis-recreation-centre</textarea><br>        
        <button type="button" onclick="scrape()">Extract</button>
    </form>
    <div id="results">
        <!-- Display scraping results here -->
    </div>
	</div>
    <script>
   function scrape() {
    var urlsInput = document.getElementById("urls").value.trim().split("\n");

    // Clear previous results
    document.getElementById("results").innerHTML = "";

    urlsInput.forEach(function(url, index) {
        fetch(url)
        .then(response => {
            if (!response.ok) {
                throw new Error("Unable to access this web page");
            }
            return response.text();
        })
        .then(data => {
            var parser = new DOMParser();
            var htmlDoc = parser.parseFromString(data, 'text/html');
            
            // Find all tables in the document
            var tables = htmlDoc.querySelectorAll('table');

            if (tables.length > 0) {
                // Loop through each table
                tables.forEach(function(table) {
                    // Initialize CSV content for this table
                    var csvContent = "";

                    // Loop through each table row
                    table.querySelectorAll('tr').forEach(function(row) {
                        // Get the day from the first cell in the row
                        var day = row.querySelector('th').textContent.trim();
                        
                        // Initialize column number counter
                        var columnNumber = 0;
                        
                        // Loop through each table cell (td) in the row
                        row.querySelectorAll('td').forEach(function(cell) {
                            // Increment column number
                            columnNumber++;
                            
                            var typeElement = cell.querySelector('strong');
                            var type = typeElement ? typeElement.textContent.trim() : '';
                            var times = cell.textContent.split(',').map(function(time) {
                                return formatTime(time.trim());
                            });
                            
                            // Loop through each time and add to CSV content
                            times.forEach(function(time) {
                                var weekday = getWeekdayFromColumnNumber(columnNumber);
                                csvContent += '"' + day + '","' + type + '","' + time + '","' + weekday + '<br>"';
                            });
                        });
                    });

                    // Append CSV content to results div
                    var resultElement = document.createElement("div");
                    resultElement.innerHTML = csvContent;
                    document.getElementById("results").appendChild(resultElement);
                });
            } else {
                // If no tables found, display message
                var noTablesMessage = document.createElement("div");
                noTablesMessage.textContent = "No tables found on this page.";
                document.getElementById("results").appendChild(noTablesMessage);
            }
        })
        .catch(error => {
            console.error('Error fetching data:', error);
            // Display error message if unable to access the page
            var errorMessage = document.createElement("div");
            errorMessage.textContent = "Unable to access this web page";
            document.getElementById("results").appendChild(errorMessage);
        });
    });
}

// Function to get weekday from column number
function getWeekdayFromColumnNumber(columnNumber) {
    switch (columnNumber) {
        case 1:
            return "Monday";
        case 2:
            return "Tuesday";
        case 3:
            return "Wednesday";
        case 4:
            return "Thursday";
        case 5:
            return "Friday";
        case 6:
            return "Saturday";
        case 7:
            return "Sunday";
        default:
            return "";
    }
}

function formatTime(time) {
    // Check if the time string contains a colon
    if (time.includes(':')) {
        // If it contains a colon, split time into parts (start and end times, am/pm)
        var parts = time.split(/[\s-]/);
        var startParts = parts[0].split(':');
        var endParts = parts[1].split(':');
        var startHour = parseInt(startParts[0]);
        var endHour = parseInt(endParts[0]);
        var startMinute = parseInt(startParts[1]);
        var endMinute = parseInt(endParts[1]);
        var ampm = parts[2] ? parts[2].toLowerCase() : '';

        // Convert hours to 24-hour format
        if (ampm === 'pm' && startHour < 12) {
            startHour += 12;
        } else if (ampm === 'am' && startHour === 12) {
            startHour = 0;
        }
        
        if (ampm === 'pm' && endHour < 12) {
            endHour += 12;
        } else if (ampm === 'am' && endHour === 12) {
            endHour = 0;
        }

        // Add leading zeros if necessary
        var formattedStartHour = startHour < 10 ? '0' + startHour : startHour;
        var formattedEndHour = endHour < 10 ? '0' + endHour : endHour;
        var formattedStartMinute = startMinute < 10 ? '0' + startMinute : startMinute;
        var formattedEndMinute = endMinute < 10 ? '0' + endMinute : endMinute;

        // Return formatted time range
        return formattedStartHour + ':' + formattedStartMinute + ' - ' + formattedEndHour + ':' + formattedEndMinute;
    } else {
        // If it doesn't contain a colon, treat it as whole hours and handle as before
        var parts = time.split(/[\s-]/);
        var startHour = parseInt(parts[0]);
        var endHour = parseInt(parts[1]);
        var ampm = parts[2] ? parts[2].toLowerCase() : '';

        // Convert hours to 24-hour format
        if (ampm === 'pm' && startHour < 12) {
            startHour += 12;
        } else if (ampm === 'am' && startHour === 12) {
            startHour = 0;
        }
        
        if (ampm === 'pm' && endHour < 12) {
            endHour += 12;
        } else if (ampm === 'am' && endHour === 12) {
            endHour = 0;
        }

        // Add leading zeros if necessary
        var formattedStartHour = startHour < 10 ? '0' + startHour : startHour;
        var formattedEndHour = endHour < 10 ? '0' + endHour : endHour;

        // Return formatted time range
        return formattedStartHour + ':00 - ' + formattedEndHour + ':00';
    }
}



    </script>
</body>
</html>
